<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.18/dist/sweetalert2.all.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script type="text/javascript" src="http://code.jquery.com/jquery-latest.js"></script>
    <script src="jquery.validate.min.js"></script>
      <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    />
</head>
<body>
    <div class="container">
        <div>
          <div class="h1">Product Management</div>
          <div class="card border-success">
            <div class="card-header">Add new product</div>
            <div class="card-body">
                    <div class="form-row align-items-center ">
                      <div class="col-5">
                        <label class="sr-only" for="inlineFormInput">Name</label>
                        <input type="text" class="form-control mb-2" name="name" id="name" placeholder="Enter name product" required>
                      </div>
                      <div class="col-3">
                        <label class="sr-only" for="inlineFormInputGroup">Category</label>
                        <div class="input-group mb-2">
                          <select
                          class="custom-select mr-sm-2"
                          id="brand"
                        >
                          <option value="IPhone" >IPhone</option>
                          <option value="NoKia">Nokia</option>
                          <option value="SamSung">SamSung</option>
                          <option value="XiaoMi">XiaoMi</option>
                        </select>
                        </div>
                      </div>
                      <div class="col-2">
                        <button type="button" class="btn btn-primary mb-2 col-12 " id="submit" onclick="addproduct()"> Add Product</button>
                        <button type="button" class="btn btn-primary mb-2 col-12  d-none"  id="update" value=""  onclick="updateProduct(this.value)">Update</button>                     
                      </div>
                      <div class="col-2">
                        <button type="button" disabled class="btn btn-outline-secondary mb-2 col-12" id="cancel" onclick="cancelAll()">Cancel</button>
                      </div>
                  
                    </div>
            </div>
          </div>
        </div>
        <div class="mt-2">
            <div class="h2">Display all product</div>
            <table class="table table-hover">
                <thead>
                  <tr>
                    <th scope="col">#</th>
                    <th scope="col">Product name</th>
                    <th scope="col">Brand name</th>
                    <th scope="col"></th>
                    <th scope="col"></th>
                  </tr>
                </thead>
                <tbody id="tbproduct">
                  
                </tbody>
              </table>
        </div>
      </div>
    </div>
    <script>
      let products = [];
      const key = "data-mobile";
      class Product {
        constructor(name, brand) {
          this.name = name;
          this.brand = brand;
        }
      }
      function init() {
        if (window.localStorage.getItem(key) == null) {
        let product1 = new Product("IPhone XS Max", "IPhone");
        let product2 = new Product("SamSung Galaxy A50", "SamSung");
        products = [product1, product2];
        setLocalStorage(key,products)
      }else{
        getLocalStorage();
      }
    }
      function showProduct() {
        let tbproduct = document.getElementById("tbproduct");
        tbproduct.innerHTML = "";
        for (let i = products.length - 1; i >0 ; i--) {
          tbproduct.innerHTML += `<tr id="tr_${i}">
                                    <td>${i }</td>
                                    <td>${products[i].name}</td>
                                    <td>${products[i].brand}</td>
                                    <td> <a href="javascript:;"  id="show" class="btn btn-outline-success "  onclick="editProduct(${i})"><i class="fa fa-edit"> Edit</i></a></td>  
                                    <td> <a href="javascript:;" class="btn btn-danger" onclick="removeProduct(${i})">Delete</a></td>
                                </tr>
                                `;
        }
      }
      function setLocalStorage(key,data){
          window.localStorage.setItem(key,JSON.stringify(data));
      }

      function getLocalStorage(){
        products= JSON.parse(window.localStorage.getItem(key));
      }

      function addproduct() {
        let productName = document.getElementById("name").value;
        let productBrand = document.getElementById("brand").value;
        if (productName == "" || productBrand == "")  {

          if(isNullOrEmpty(productName) || isNullOrEmpty(productBrand)){
              alert("Product is required!");
          }
        } else {
          let product = new Product(productName, productBrand) ;
          Swal.fire({
          icon: 'success',
          title: 'Your work has been saved',
          showConfirmButton: false,
          timer: 1500
    });
        products.push(product);
        setLocalStorage(key, products);
          showProduct();
          clearData();
        }
      
      }
         

      function editProduct(i){
        document.getElementById("submit").classList.add("class","d-none");
        document.getElementById("update").classList.remove("d-none");
        document.getElementById("cancel").removeAttribute("disabled");
        product = JSON.parse( localStorage.getItem(key))[i];
        document.getElementById("name").value = product.name;
        document.getElementById("brand").value = product.brand;
        document.getElementById("update").value = i;
      }

      function updateProduct(i){
        products[i].name = document.getElementById("name").value;
        products[i].brand = document.getElementById("brand").value;
        Swal.fire({
          icon: 'success',
          title: 'Your work has been saved',
          showConfirmButton: false,
          timer: 1500
    });
        setLocalStorage(key,products);
        cancelAll();
        clearData();
        showProduct();
      }

      function cancelAll(){
        document.getElementById("submit").classList.remove("d-none");
        document.getElementById("update").classList.add("d-none");
        document.getElementById("cancel").setAttribute("disabled", true);
        clearData();
      }

      function removeProduct(i){
        Swal.fire({
          title: 'Are you sure?',
          text: "You won't be able to revert this!",
          icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#3085d6',
        cancelButtonColor: '#d33',
        confirmButtonText: 'Yes, delete it!'
  }).then((result) => {
    if (result.isConfirmed) {
      Swal.fire(
        'Deleted!',
        'Your file has been deleted.',
        'success'
       
      )
      products.splice(i, 1);
      setLocalStorage(key, products);
      showProduct();
    }
  })

      }

      function isNullOrEmpty(str) {
        return str == null || str.trim() == "";
      }

      function clearData(){
        document.getElementById("name").value = "";
      }

      function documentReady() {
        init();
        showProduct();
      }
  
      documentReady();
  
    </script>
  </body>
</html>
